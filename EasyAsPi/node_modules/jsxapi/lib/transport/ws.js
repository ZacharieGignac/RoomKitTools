"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var url_parse_1 = __importDefault(require("url-parse"));
function base64Enc(input) {
    return (typeof btoa === 'function')
        ? btoa(input)
        : Buffer.from(input).toString('base64');
}
function generateAuthSubProto(username, password) {
    var replaceChars = { '+': '-', '/': '_', '=': '' };
    var authHash = Buffer
        .from(username + ":" + password)
        .toString('base64')
        .replace(/[/+=]/g, function (c) { return replaceChars[c]; });
    return "auth-" + authHash;
}
function websocketConnect(createWebSocket, opts) {
    var host = opts.host, username = opts.username, password = opts.password, port = opts.port, protocol = opts.protocol;
    var url = new url_parse_1.default('');
    url.set('pathname', '/ws');
    url.set('host', host);
    url.set('protocol', protocol);
    url.set('port', "" + port);
    var auth = generateAuthSubProto(username, password);
    return createWebSocket(url.href, auth);
}
exports.default = websocketConnect;
